\subsection{Modulacja szerokości impulsu (PWM)}
Implementacja PWM umożliwia precyzyjne sterowanie elementami wykonawczymi wymagającymi sygnału analogowego, takimi jak silniki czy regulacja jasności diody LED. Funkcjonalność obejmuje konfigurację częstotliwości sygnału PWM, ustawianie wypełnienia impulsu (duty cycle) oraz dynamiczną zmianę parametrów w zależności od warunków środowiskowych. PWM jest wykorzystywane do regulacji intensywności świecenia diod LED w diodzie RGB LED3 [schemat]. %dodaj schemat
W projekcie został wykorzystany PWM1.

\subsubsection{Inicjalizacja PWM1}
\begin{enumerate}
    \item Konfigurację rozpoczynamy od włączenia zasilania. W tym celu ustawiamy 6 bit w rejestrze PCONP (tabela 46.) %odwolanie do dokumentacji
    \item Piny na których chcemy sterować impulsami to P2.0, P2.1, P2.2. Chcemy je ustawić jako PWM1.1, PWM1.2, PWM1.3, dlatego w rejestrze PINSEL4 ustawiamy bity 1:0, 3:2, 5:4 na 01 - funkcja PWM1.X
    % \item Następnie wybieramy tryb pracy na single edge, czyli
    \item Opis rejestrów PWM1:\\
    \begin{enumerate}
        \item \textbf{IR} - rejestr ten służy do zarządzania przerwaniami. Przerwania 
        \begin{enumerate}
            \item \textbf{PWMMR0 Interrupt} - bit 0, flaga przerwania na kanale 0
            \item \textbf{PWMMR1 Interrupt} - bit 1, flaga przerwania na kanale 1
            \item \textbf{PWMMR2 Interrupt} - bit 2, flaga przerwania na kanale 2
            \item \textbf{PWMMR3 Interrupt} - bit 3, flaga przerwania na kanale 3
            \item \textbf{PWMCAP0 Interrupt} - bit 4, flaga przerwania dla zerowego wejscia przechwytującego (capture input); capture oznacza przechwycenie aktualnej wartości licznika (timer'a), np. w momencie zbocza sygnału (narastającego lub opadającego) na pinie wejściowym. Umożliwia to np. pomiar czasu trwania impulsów, okresów czy częstotliwości.
            \item \textbf{PWMCAP1 Interrupt} - bit 5, flaga przerwania dla pierwszego wejscia przechwytującego 
            \item Bity 7:6 - zarezerwowane
            \item \textbf{PWMMR4 Interrupt} - bit 8, flaga przerwania na kanale 4
            \item \textbf{PWMMR5 Interrupt} - bit 9, flaga przerwania na kanale 5
            \item \textbf{PWMMR6 Interrupt} - bit 10, flaga przerwania na kanale 6
            \item Bity 31:11 - zarezerwowane

        \end{enumerate}
        \item \textbf{PWM1TCR}
        \begin{enumerate}
            \item \textbf{Counter Enable} - bit 0, włączanie i wyłączanie licznika timera oraz preskalera
            \item \textbf{Counter Reset} - bit 1, resetowanie licznika timera, synchoronizacja z kolejnym zboczem narastającym PCLK, tak długo, aż wartość tego bitu będzie równa 1
            \item Bit 2 - zarezerwowany
            \item \textbf{PWM Enable} - gdy wartość bitu jest róna 1 - \textbf{tryb PWM}, licznik resetuje się do 1, aktywuje shadow registery.\\
                            Gdy wartość bitu jest równa 0 - \textbf{tryb timer}, licznik resetuje się do 0, bez PWM - działą jak zwykły timer.
            \item Bit 4:31 - zarezerwowane
        \end{enumerate}
        \item \textbf{PWM1CTCR} - rejestr służy do wyboru trybu licznika - timer lub jako licznik zliczający impulsy z zewnętrznego źródła. 
        \begin{enumerate}
            \item \textbf{Counter/Timer Mode} - bity 0:1, wartości i odpowiadające im działanie zostały opisane w poniższej tabeli.
            \begin{table}[H]
                \centering
                \begin{tabular}{|c|c|}
                    \hline
                    Wartość & Opis\\
                    \hline
                    00  & Timer mode: Timer Counter (TC) wykorzystuje Prescale Counter (PC) oraz Prescale Register (PR), aby móc działać wolniej. TC inkrementuje się gdy PC = PR\\
                    01 & Counter Mode: TC zlicza impulsy przychodzące (inkrementacja przy każdym zboczu narastającym) z zewnętrznego pinu wybranego na bitach 3:2  \\
                    10 & Counter Mode: TC zlicza impulsy przychodzące (inkrementacja przy każdym zboczu opadającym) z zewnętrznego pinu wybranego na bitach 3:2  \\
                    11 & Counter Mode: TC zlicza impulsy przychodzące (inkrementacja przy na obu zboczach impulsu) z zewnętrznego pinu wybranego na bitach 3:2  \\
                    \hline
                \end{tabular}
                \caption{Rodzaje pracy w trybie Timer/Counter}
            \end{table}
            \item \textbf{Count Input Select} - bity 3:2 - ta częśćrejestru odpowiada za wybó pinu PCAP z którego będą zliczane impulsy.\\
            \begin{table}[H]
                \centering
                \begin{tabular}{|c|c|}
                    \hline
                    Wartość & Opis\\
                    \hline
                    00  & Timer mode: Timer Counter (TC) wykorzystuje Prescale Counter (PC) oraz Prescale Register (PR), aby móc działać wolniej. TC inkrementuje się gdy PC = PR\\
                    01 & Counter Mode: TC zlicza impulsy przychodzące (inkrementacja przy każdym zboczu narastającym) z zewnętrznego pinu wybranego na bitach 3:2  \\
                    10 & Counter Mode: TC zlicza impulsy przychodzące (inkrementacja przy każdym zboczu opadającym) z zewnętrznego pinu wybranego na bitach 3:2  \\
                    11 & Counter Mode: TC zlicza impulsy przychodzące (inkrementacja przy na obu zboczach impulsu) z zewnętrznego pinu wybranego na bitach 3:2  \\
                    \hline
                \end{tabular}
                \caption{Rodzaje pracy w trybie Timer/Counter}
            \end{table}
            



        \end{enumerate}

    \end{enumerate}
\end{enumerate}
